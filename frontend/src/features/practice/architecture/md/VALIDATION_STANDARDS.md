# 아키텍처 검증 기준 (최종)

## 🎯 검증 3단계 기준

### **1단계: 기본 구조** (필수 - 모두 통과해야 함) 🚨

```
✅ 컴포넌트 최소 3개 배치 ⚠️ ERROR
   └─ 미충족 시: "컴포넌트가 부족합니다 (현재: X개, 필요: 3개 이상)"

✅ 연결 최소 1개 이상 존재 ⚠️ ERROR
   └─ 미충족 시: "컴포넌트 간 연결이 필요합니다 (최소 1개)"

✅ 모든 컴포넌트가 연결됨 (고립된 컴포넌트 ZERO) ⚠️ ERROR (중요!)
   └─ 미충족 시: "모든 컴포넌트가 연결되어야 합니다. 고립된 컴포넌트: [목록]"
   └─ 이유:
      • 계획 없는 임의 배치 방지
      • 모든 컴포넌트가 시스템의 일부여야 함
      • 고립된 컴포넌트 = 아키텍처 미흡의 신호
```

---

### **2단계: 필수 요구사항** (맞춤형 - 문제별로 다름) 📋

```
✅ 필수 컴포넌트 충족도 ≥ 70% ⚠️ ERROR
   └─ 예: jr_001이 [Web Server, RDBMS, Cache] 필수면
          - 3개 중 2개 이상 포함해야 통과
          - 미충족 시: "필수 컴포넌트 충족도 XX% (누락: [목록])"

✅ 모든 Required Flow 구현 ⚠️ ERROR
   └─ 예: required_flows = [
            { from: "Web Server", to: "Cache", reason: "Read-through" },
            { from: "Cache", to: "RDBMS", reason: "Cache miss" }
          ]
      - 이 2개 연결이 모두 구현되어야 함
      - 미충족 시: "필수 연결 누락: Web Server → Cache (Read-through)"
```

---

### **3단계: 설계 품질** (선택적 - 정보만 제공) 📊

```
⚠️ 컴포넌트 타입 다양성 (정보만 제공, 불통과 아님)
   └─ 권장: 3가지 이상의 타입 (Server, Cache, Storage, Broker 등)
   └─ 미만족 시: 경고 메시지만 표시

⚠️ 한 가지 타입 편중 체크 (정보만 제공)
   └─ 권장: 단일 타입이 60% 미만
   └─ 초과 시: "한 가지 타입이 과도하게 많습니다" 경고
```

---

## 💡 사용자 질문 해결

**Q: "연결도 다 이어져야하는거 아닐까??"**

**A: 맞습니다!** ✅

고립된 컴포넌트(어떤 연결도 없는 컴포넌트)가 있으면 **불통과**입니다.

### 예시

| 상황 | 결과 | 이유 |
|------|------|------|
| A → B → C (3개 모두 연결) | ✅ 통과 | 모든 컴포넌트가 시스템의 일부 |
| A → B, C (C 고립) | ❌ 불통과 | C가 어디에도 연결 안 됨 |
| A → B, A → C (둘 다 연결) | ✅ 통과 | A는 B와 C 모두 연결됨 |
| A (단독, 연결 없음) | ❌ 불통과 | A가 고립됨 |

### 고립된 컴포넌트 찾기

```javascript
// 어떤 연결에도 참여하지 않은 컴포넌트 = 고립
const connectedIds = new Set();

connections.forEach(conn => {
  connectedIds.add(conn.from);  // 출발점
  connectedIds.add(conn.to);    // 도착점
});

const isolated = components.filter(comp =>
  !connectedIds.has(comp.id)
);
```

---

## 🚨 검증 실패 메시지

### 1단계 실패

```
❌ 검증 실패

컴포넌트가 부족합니다 (현재: 2개, 필요: 3개 이상)

💡 제안: 먼저 컴포넌트를 3개 이상 배치하고 연결해주세요
```

```
❌ 검증 실패

컴포넌트 간 연결이 필요합니다 (최소 1개)

💡 제안: 먼저 컴포넌트를 3개 이상 배치하고 연결해주세요
```

```
❌ 검증 실패

모든 컴포넌트가 연결되어야 합니다. 고립된 컴포넌트: API Gateway, Load Balancer

💡 제안: 고립된 컴포넌트들을 시스템에 연결하세요
```

### 2단계 실패

```
❌ 검증 실패

필수 컴포넌트 충족도 부족 (현재: 33%, 필요: 70% 이상)
누락된 컴포넌트: Redis, RDBMS

💡 제안: 필수 컴포넌트와 연결을 추가하고 다시 시도해주세요
```

```
❌ 검증 실패

필수 연결이 누락되었습니다:
- "Web Server" → "Cache": 단축 URL 키로 원본 URL 우선 조회 (연결 누락)
- "Cache" → "RDBMS": 캐시 미스 시 DB 조회 및 결과 캐싱 ("Cache" 컴포넌트 누락)

💡 제안: 필수 컴포넌트와 연결을 추가하고 다시 시도해주세요
```

---

## ✅ 검증 통과 메시지

```
✅ 검증 통과

✅ 아키텍처가 유효한 기본 요구사항을 충족합니다

✅ 검증 단계별 결과
┌─ Stage 1: 기본 구조 ✅
│  ✓ 컴포넌트: 4개
│  ✓ 연결: 3개
│  ✓ 고립된 컴포넌트: 0개
│
├─ Stage 2: 필수 요구사항 ✅
│  필수 컴포넌트: 100% 충족
│  필수 연결: 2/2 구현
│
└─ Stage 3: 설계 품질
   컴포넌트 타입: 4가지
   다양성 점수: 100%

⚠️ 개선 권장사항
• 고립된 컴포넌트는 없으나, Load Balancer의 사용 목적을 명확히 하세요
```

---

## 📊 통과/불통과 판정표

| 조건 | 상태 | 영향 |
|------|------|------|
| 컴포넌트 < 3 | ERROR | 불통과 |
| 연결 < 1 | ERROR | 불통과 |
| **고립된 컴포넌트 > 0** | **ERROR** | **불통과** ⚠️ 중요 |
| 필수 컴포넌트 < 70% | ERROR | 불통과 |
| 필수 Flow 미구현 | ERROR | 불통과 |
| 타입 < 3가지 | WARNING | 통과 (정보만) |
| 타입 편중 > 60% | WARNING | 통과 (정보만) |

---

## 🎯 설계자가 해야 할 것

### ✅ 모든 컴포넌트를 연결하세요
```
좋음: A → B → C → D (모두 연결)
좋음: A → B ← C → D (복잡하지만 모두 연결)
좋음: A → B, A → C, A → D (A 중심)

나쁨: A → B, C (C가 고립)
나쁨: A, B, C (아무것도 안 연결)
나쁨: A → B → C, D (D가 고립)
```

### ✅ 데이터 흐름을 명확하게
```
• 입력점 (Client, Request)
• 처리 계층 (Server, Gateway)
• 저장소 (Database, Cache)
• 출력점 (Response, Client)

모든 컴포넌트가 이 흐름에 참여해야 함
```

---

## 🔍 고립 여부 확인 방법

**Canvas에서 각 컴포넌트를 확인하세요:**

```
✅ 올바른 설계
   [Client] → [Web Server] → [Cache] → [RDBMS]
               ↓
            [Worker]  (Worker도 Web Server와 연결됨)

❌ 잘못된 설계
   [Client] → [Web Server] → [Cache] → [RDBMS]

   [Load Balancer]  ← 혼자 떨어져 있음 (고립)
```

---

## 💬 자주 묻는 질문

**Q: 몇 개의 연결이 필요한가?**
A: 최소 1개. 하지만 모든 컴포넌트가 어딘가에 연결되어야 합니다.

**Q: 연결 방향(방향성)이 중요한가?**
A: 현재는 방향성을 체크하지 않습니다. 하지만 논리적 데이터 흐름을 고려하세요.

**Q: 순환 구조(A → B → A)는 괜찮은가?**
A: 기술적으로는 허용되지만, 실제 아키텍처에서는 피하세요.

**Q: 컴포넌트 이름을 여러 개 같게 해도 되나?**
A: 가능하지만, 각각 고유한 ID로 구분됩니다.

---

## 🎓 핵심 요점

### 1단계를 반드시 통과하려면:

✅ 컴포넌트 **3개 이상**
✅ 연결 **1개 이상**
✅ **고립된 컴포넌트 ZERO** ← 가장 중요!

```
"고립된 컴포넌트가 있다" = "이 컴포넌트는 왜 여기 있는가?"
```

---

마지막으로: 좋은 질문입니다! 이제 모든 컴포넌트가 연결되어야 한다는 기준이 명확해졌습니다. 🚀
