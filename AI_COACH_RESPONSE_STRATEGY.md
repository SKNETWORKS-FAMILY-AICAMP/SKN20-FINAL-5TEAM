# AI 코치 응답 전략 가이드 (고도화 버전)

## 🎯 핵심 개선사항 (v2.0)

### 📍 Two-Stage Architecture
```
[Stage 1] Intent Analysis (LLM)
  사용자 질문 → A-G 중 분류 (의도 판정)

[Stage 2] Response Strategy (LLM + Tools)
  의도에 맞는 프롬프트 조정 → 도구 호출 & 응답 생성
```

### ✨ 기대 효과
- **정확한 의도 파악**: 모호한 질문도 명확히 분류
- **맞춤형 응답**: A-G 각 유형에 최적화된 프롬프트
- **투명한 사고 과정**: 의도 분류 결과를 사용자에게 공개
- **도구 활용 최적화**: 의도별로 필요한 도구만 선택적 호출

---

## 📌 질문 유형별 응답 전략 (A-G)

---

### **A. 데이터 조회형**
**예시**: "내 성적 보여줘", "약점이 뭐야"

- **도구 활용**: ✅ 적극 활용
- **응답 전략**:
  - 사용자 학습 데이터 조회 → 성적, 약점, 진행 현황 분석
  - 데이터 중심 답변 (구체적 수치, 통계 포함)
  - 시각화 제안 (그래프, 표 등)
- **주의점**: 데이터만 제시하지 말고, 의미 있는 인사이트 함께 제공

---

### **B. 학습 방법형**
**예시**: "디버깅 공부 어떻게 해?", "의사코드 잘 쓰는 팁"

- **도구 활용**: 선택적 활용
- **응답 전략**:
  1. 도구로 **현재 수준** 파악 (어느 정도 알고, 어디서 막히는가)
  2. 수준에 맞는 **구체적 학습 방법론** 제시 (메인)
  3. 데이터는 **근거로만 간략히** 언급
  - 예: "너는 기초가 있으니 → (방법론), 만약 기초가 약하다면 → (다른 방법론)"
- **구성**: 데이터 5% + 방법론 95%

---

### **C. 동기부여형**
**예시**: "자신감이 없어", "잘할 수 있을까", "나는 왜 이것도 못 하지"

- **도구 활용**: ✅ 반드시 활용
- **응답 전략**:
  1. 도구로 **성장 데이터** 확인 (과거와 비교, 개선점 찾기)
  2. 격려 (감정 인정) + 작은 목표 제시
  3. 구체적 성공 사례 제시 (너가 이전에 푼 것들)
- **톤**: 따뜻하고 현실적 (거짓 격려 ❌)

---

### **D. 범위 밖 질문**
**예시**: "파이썬 문법 알려줘", "날씨가 어때?", "주식 추천해줘"

- **도구 활용**: ✅ 호출하지 않음
- **응답 전략**:
  - 학습 코칭 범위 안내 (명확하고 정중하게)
  - 관련된 학습 질문으로 자연스럽게 유도
  - 예: "파이썬 문법은 공식 문서를 추천해요. 대신 문법을 '실제 문제에 어떻게 적용하는가'에 대해 물으면 도와줄게요"

---

### **E. 문제 풀이 지원형**
**예시**: "이 문제 못 풀었어", "풀이 과정 알려줘", "이 코드 뭐가 틀렸어?"

- **도구 활용**: ✅ 문제 유형 분석, 사용자의 과거 풀이 패턴
- **응답 전략**:
  1. **정답 직접 제시** ❌
  2. 단계별 접근:
     - (1단계) 문제의 핵심 요구사항 재확인
     - (2단계) 사용자 약점 기반 **힌트** 제시
     - (3단계) 단계별 **검산 포인트** 안내
  3. 사용자가 직접 풀이를 완성하도록 유도
- **효과**: 상담적 학습 (cognitive scaffolding)

---

### **F. 개념 설명형**
**예시**: "스택이 뭐야?", "정렬 알고리즘 차이", "재귀 어려워"

- **도구 활용**: ✅ 사용자의 현재 수준, 해당 개념 관련 과거 문제 성적 조회
- **응답 전략**:
  1. 사용자 수준에 맞는 설명 (기초 vs 심화)
  2. 개인화된 비유/예시 제시
  3. 학습 데이터와 연계:
     - "너는 배열 개념이 강하니까, 스택도 이렇게 생각해봐: 배열의 특수한 경우"
     - "너는 트리에서 막혔던 것처럼, 여기서도 '순서'가 핵심이야"
- **핵심**: 같은 개념이라도 사용자별 설명 방식 다르게

---

### **G. 성과 비교 & 의사결정형**
**예시**: "이 풀이가 더 나아?", "어떤 방법 추천해?", "다음은 뭐 풀어야 해?"

- **도구 활용**: ✅ 유사한 이전 문제들의 성공/실패 패턴, 학습 효율 지표
- **응답 전략**:
  1. **객관적 비교** (시간복잡도, 가독성, 학습 효과)
  2. 사용자 맥락 고려한 권장:
     - "이론적으로는 A가 더 효율적이지만, 너는 시간복잡도에 약하니까 A 방식을 추천해"
     - "두 방식 다 괜찮은데, 너의 약점을 보면 B 방식이 더 학습 가치가 있어"
  3. 선택의 근거를 명확히 설명

---

## 🎯 메타 전략 (전체 적용)

| 항목 | 설명 |
|------|------|
| **문맥 유지** | 같은 세션 내 이전 질문과의 연계성 유지 (예: "아까 물어본 그 알고리즘 말이야") |
| **점진적 도움** | 처음엔 큰 힌트 → 막히면 더 구체적으로 (사용자가 노력할 여지 제공) |
| **실패 다루기** | "못 풀었다"는 것을 실패로 보지 않고, 학습 기회로 프레이밍 |
| **근거 명확화** | 조언할 때 항상 "너의 데이터를 보니..." 로 개인화 근거 제시 |
| **도구 투명성** | 도구 호출하는 것을 자연스럽게 (예: "너의 최근 풀이를 보니...") |

---

## 📊 질문 유형별 도구 활용 요약

| 유형 | 도구 활용 | 데이터 비중 | 조언 비중 | 주요 목표 |
|------|---------|-----------|---------|---------|
| A. 데이터 조회형 | 적극 | 80% | 20% | 인사이트 제공 |
| B. 학습 방법형 | 선택 | 20% | 80% | 실행 계획 제시 |
| C. 동기부여형 | 필수 | 40% | 60% | 성장 확인 + 격려 |
| D. 범위 밖 | 없음 | 0% | 100% | 범위 안내 + 유도 |
| E. 문제 풀이 | 선택 | 10% | 90% | 자력 완성 유도 |
| F. 개념 설명형 | 필수 | 30% | 70% | 수준별 이해 |
| G. 성과 비교 | 필수 | 50% | 50% | 근거 기반 권장 |

---

## 💡 구현 체크리스트

### ✅ 완료 (v2.0)
- [x] Intent Analysis LLM 추가 (별도 단계)
- [x] 각 유형별 Response Strategy Prompt 정의
- [x] ReAct/tool-calling 패턴 구현
- [x] SSE 스트리밍으로 단계별 응답 제시
  - 의도 분석 중...
  - 도구 호출 (get_user_scores, get_weak_points 등)
  - 최종 응답 토큰 단위 전송
- [x] 의도 분류 결과를 클라이언트에 전달 (transparency)

### ⏳ 향후 계획
- [ ] 세션 내 문맥 유지 (multi-turn 메모리)
- [ ] 데이터 시각화 컴포넌트 연동 (특히 A, C, G 유형)
- [ ] 반복 질문 최소화 (캐싱, 세션 기반 학습)
- [ ] 평가 지표: 사용자 만족도, 질문 해결율 추적

### 🔌 API 엔드포인트
- **기존**: `POST /api/core/ai-coach/chat/` (v1)
- **신규**: `POST /api/core/ai-coach/chat-v2/` (고도화 버전)

