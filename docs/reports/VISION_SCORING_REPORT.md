# AI 비언어 태도 분석 결과 산출 원리

본 문서는 첨부된 **"AI 비언어 태도 분석 결과"** 화면에 나타난 각종 지표(종합 안정성, 시선 집중도, 자세 유지력, 표정 밸런스, 행동 로그)가 시스템 내부(`useVisionAnalysis.js` 및 `visionWorker.js`)에서 어떻게 측정되고 산출되는지 분석한 내용입니다.

## 1. 분석 엔진 및 샘플링 방식
- **엔진 프로세스**: Google MediaPipe 비전 모듈(FaceLandmarker, PoseLandmarker)을 메인 스레드 부하를 막기 위해 Web Worker(`visionWorker.js`)에서 비동기로 구동합니다.
- **샘플링 주기**: 사용자의 웹캠 영상을 0.5초(500ms, 2FPS 속도) 주기로 캡처하여 데이터를 전송합니다.
- **스위칭 로직**: 연산 부하 최적화를 위해 들어오는 프레임을 교차(짝수 번째=얼굴, 홀수 번째=자세)하여 분석합니다.

---

## 2. 세부 지표(Metric) 산출 원리

### 2.1 시선 집중도 (Gaze Focus) - *이미지상 99%*
- **추출 부위**: 랜드마크 기반으로 코끝(Nose)과 좌우 눈(Left/Right Eye)의 3차원 좌표를 추출합니다.
- **측정 방식 (Yaw & Pitch 다방향 휴리스틱)**: 
  1. **좌우 이탈 (Yaw)**: 코가 두 눈 사이의 수평적 중앙에서 얼마나 벗어나 있는지를 계산합니다. (거울 모드 등 웹캠 좌우 반전을 고려하여 두 눈의 거리 차이는 절대값을 사용합니다.)
     - `수식: abs(코.x - 눈중앙.x) / abs(오른쪽눈.x - 왼쪽눈.x)`
     - 계산된 이탈 값이 **0.15 미만**일 때 '정면'으로 간주합니다.
  2. **상하 이탈 (Pitch)**: 코끝과 양쪽 눈썹선의 Y축 간격 비율을 계산하여 고개를 과도하게 숙이거나 치켜들었는지 판별합니다.
     - `수식: (코.y - 눈중앙.y) / 양안거리`
     - 값이 일반적인 이목구비 비율인 **0.4 ~ 0.95 사이**에 속할 때만 정면 응시로 인정합니다. 이 범위를 벗어나면 책상을 내려다보거나 천장을 보는 등 고개를 숙이거나 들었다고 판별합니다.
- 좌우(Yaw) 및 상하(Pitch) 양쪽 조건을 모두 만족할 때만 엄격하게 '정면을 바라보고 있다'고 응시 판정을 내립니다.
- **점수 산출**: 전체 얼굴 감지 샘플 횟수 중 정면 응시 판별을 받은 횟수의 비율을 퍼센트(%)로 변환합니다.

### 2.2 자세 유지력 (Posture) - *이미지상 0%*
- **추출 부위**: PoseLandmarker 동작을 통해 코 위치(Nose)와 좌우 어깨(Left/Right Shoulder)의 3D 랜드마크를 추출합니다.
- **측정 방식 (다차원 3D 휴리스틱)**: 단순히 y좌표 뿐만 아니라 카메라와의 깊이인 z좌표를 함께 계산합니다.
  1. **수평 기울기 (Y축)**: 좌측 어깨와 우측 어깨의 높낮이 차이(`abs(왼어깨.y - 오른어깨.y)`)가 일상적인 웹캠 환경의 오차를 반영하여 **0.10 미만**이어야 합니다. (너무 엄격하던 기존 0.05에서 완화)
  2. **틀어짐 (Z축)**: 좌우 어깨의 카메라 깊이 차이(`abs(왼어깨.z - 오른어깨.z)`)가 **0.15 미만**으로 몸통이 한쪽으로 치우치지 않아야 합니다.
  3. **거북목 및 기대기 (코-어깨 Z상대 깊이)**: 코는 보통 어깨보다 앞에 위치하므로(음수 차이), 코 Z값과 양쪽 어깨 Z값 평균 간의 차이가 지나치게 멀리 나가거나(`-0.4` 초과) 아예 뒤로 젖히면 안 됩니다(`-0.05` 이상).
- 위 세 가지 조건(수평, 뒤틀림, 앞뒤 기울기)을 모두 통과해야 1회 '바른 자세'로 판별합니다.
- **분석**: 화면 상에 0%로 측정된 것은 검사가 진행되는 내내 사용자의 복합적인 3D 자세 지표가 지속적으로 범위를 벗어났음(거북목, 틀어짐, 수평 불량 등)을 의미합니다.

### 2.3 표정 밸런스 (Emotions) - *이미지상 5% Positive*
- **추출 부위**: 얼굴 근육과 표정의 변화량을 나타내는 MediaPipe Blendshapes 점수 체계를 사용합니다.
- **카테고리 분류**:
  1. **미소 (Positive/Smile)**: 양쪽 입꼬리 당김 지수(`mouthSmileLeft`, `mouthSmileRight`)의 평균이 면접에 어울리는 옅은 미소 기준인 **0.15**를 초과할 때 판정합니다. (기존 0.4에서 완화)
  2. **긴장 (Negative/Tension)**: 입술 압착 지수(`mouthPress`)가 0.2를 초과할 때 판정합니다.
  3. **무표정 (Neutral)**: 위 두 상태에 모두 해당하지 않을 때 무표정으로 분류됩니다.
- **결과**: 전체 표정 데이터 중 각 카테고리가 차지하는 비중을 계산하여, 미소가 5%, 나머지가 주로 무표정과 긴장 상태로 바(Bar)에 노출됩니다. 면접 특성상 무표정이 주를 이루기 때문에 옅은 미소도 긍정 수치로 합산됩니다.

### 2.4 종합 안정성 (Stability) - *이미지상 50*
- 하단의 '시선 및 자세 정면 유지 비율' 설명과 같이, **시선 집중도(99)와 자세 유지력(0)의 평균치인 (99+0)/2 = 49.5를 반올림하여 50이라는 종합 스코어**를 시각화한 것입니다.

---

## 3. 행동 로그 기록 조건 (BEHAVIORAL LOGS)
분석 진행 중 특정 수치가 임계점을 넘어갈 때 로그 기록과 함께 알림을 남깁니다.

- **`[시간] 시선이 정면을 벗어났습니다.`**
  - 시선 집중도 평가(Yaw 휴리스틱) 시 이탈 값이 0.25를 넘어 시선이 밖으로 향했을 때 발생합니다.
  - 단, 도배를 막기 위해 같은 로그는 최소 10초(`TOAST_COOLDOWN`)의 쿨타임을 두고 한 번씩만 찍힙니다.
  
- **`[시간] 자연스러운 미소 감지 (긍정적 인상)`**
  - 추출된 입꼬리 당김 지수 평균이 0.4를 초과할 때 감지됩니다.
  - 얼굴 분석 20프레임마다(약 20초 간격) 1번씩 로그를 남겨 빈도를 조절합니다. (긴장 조건도 동일하게 20프레임 주기로 '긴장된 표정 감지' 로그 발생)
