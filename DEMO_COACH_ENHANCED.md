# AI 코치 고도화 버전 (v2.0) - 데모 예제

## 🎯 테스트 시나리오

### 시나리오 1️⃣: A형 (데이터 조회형)

**사용자 질문:**
```
"내 성적이 어떻게 되고 있어?"
```

**백엔드 처리 플로우:**

1. **Intent Analysis**
   ```
   입력: "내 성적이 어떻게 되고 있어?"
   ↓
   의도 분석 LLM
   ↓
   결과:
   {
     "intent_type": "A",
     "confidence": 0.98,
     "reasoning": "성적 조회 요청",
     "key_indicators": ["성적", "어떻게"]
   }
   ```

2. **Response Strategy 선택**
   ```
   의도: A (데이터 조회형)
   →
   시스템 프롬프트:
   "당신은 AI 학습 코치입니다.
    [역할: 데이터 기반 인사이트 제공]
    - 사용자 학습 데이터를 제시하고 의미를 해석
    - 데이터 비중 80% + 조언 20%"
   ```

3. **Tool Calling**
   ```
   LLM의 ReAct 루프:
   ┌─────────────────────────────┐
   │ 도구 호출: get_user_scores  │
   │ 인자: {}                    │
   └─────────────────────────────┘
            ↓
   결과 (DB에서 조회):
   [
     {
       "unit_id": "unit01",
       "unit_title": "의사코드",
       "avg_score": 75.5,
       "max_score": 95,
       "solved_count": 8,
       "total_problems": 10,
       "completion_rate": 80.0
     },
     {
       "unit_id": "unit02",
       "unit_title": "디버깅",
       "avg_score": 68.3,
       "solved_count": 5,
       "total_problems": 10,
       "completion_rate": 50.0
     },
     {
       "unit_id": "unit03",
       "unit_title": "시스템아키텍처",
       "avg_score": 82.0,
       "solved_count": 6,
       "total_problems": 8,
       "completion_rate": 75.0
     }
   ]
   ```

4. **최종 응답 생성 (SSE 스트리밍)**
   ```
   LLM이 tool result를 받아서 응답 생성:

   "## 당신의 학습 현황 📊

   **전체 평가:** 75점대 중반으로 꾸준히 학습 중이에요!

   - 🟢 **의사코드**: 75.5점 (80% 완료) → 기초가 잘 잡혔어요
   - 🟡 **디버깅**: 68.3점 (50% 완료) → 여기가 약점이네요
   - 🟢 **아키텍처**: 82점 (75% 완료) → 설계 감각이 뛰어나요

   **다음 액션:**
   디버깅 단원에서 2문제가 남아있어요.
   68점대를 70점대로 올리려면 오류 원인 분석 능력을 더 다지면 좋을 것 같아요."

   (토큰 단위로 스트리밍 전송)
   ```

---

### 시나리오 2️⃣: B형 (학습 방법형)

**사용자 질문:**
```
"의사코드 공부 어떻게 해야 잘할 수 있어?"
```

**백엔드 처리 플로우:**

1. **Intent Analysis**
   ```
   입력: "의사코드 공부 어떻게 해야 잘할 수 있어?"
   ↓
   의도 분석 LLM
   ↓
   결과:
   {
     "intent_type": "B",
     "confidence": 0.96,
     "reasoning": "학습 방법론 요청",
     "key_indicators": ["공부", "어떻게", "어디서"]
   }
   ```

2. **Response Strategy 선택**
   ```
   의도: B (학습 방법형)
   →
   시스템 프롬프트:
   "당신은 학습 방법론 전문가입니다.
    [역할: 수준별 학습 방법론 제시]
    - 현재 수준 파악 (20%)
    - 구체적 학습 방법론 (70%)
    - 지금 당장 할 수 있는 행동 (10%)"
   ```

3. **Tool Calling**
   ```
   LLM의 ReAct 루프:
   ┌─────────────────────────────────────┐
   │ 도구 호출: get_weak_points          │
   │ 인자: {"unit_id": "unit01"}        │
   └─────────────────────────────────────┘
            ↓
   결과 (unit01의 약점 분석):
   {
     "unit_id": "unit01",
     "total_solved": 8,
     "weak_areas": [
       {"metric": "구조화", "avg_score": 62.5},
       {"metric": "명확성", "avg_score": 68.0}
     ],
     "all_metrics": [
       {"metric": "논리성", "avg_score": 82.0},
       {"metric": "구조화", "avg_score": 62.5},
       {"metric": "명확성", "avg_score": 68.0},
       {"metric": "효율성", "avg_score": 75.0}
     ]
   }
   ```

4. **최종 응답 생성**
   ```
   LLM이 약점 데이터를 바탕으로 맞춤 학습 방법론 제시:

   "## 의사코드 학습 로드맵 🗺️

   **당신의 현재 수준:**
   - 논리성: 매우 좋음 (82점)
   - 구조화: 개선 필요 (62점) ← 여기가 약점
   - 명확성: 보통 (68점)

   **3단계 학습 방법:**

   **1단계: 구조 설계 연습 (1~2주)**
   - Top-Down 접근법: 큰 문제 → 작은 단계로 분해
   - 매일 1개 문제마다 '나는 어떻게 구조를 나눴는가' 써보기
   - 추천 문제: 당신이 풀다가 실패한 문제들 다시 보기

   **2단계: 명확성 높이기 (1~2주)**
   - 변수명을 더 의미 있게: 'x' → 'user_input_value'
   - 각 단계마다 한글 주석 달기 (2~3줄)
   - 완성 후 코드를 읽으면서 "이게 뭐 하는 코드인가?" 설명해보기

   **3단계: 실전 복습 (지속)**
   - 매주 1~2개의 어려운 문제 풀이
   - 과거 풀이와 비교해서 '뭐가 좋아졌나' 확인

   **오늘 바로 할 수 있는 것:**
   지난주 점수 62점인 '데이터 구조 설계' 문제를 다시 풀어보세요.
   이번엔 '어떻게 단계를 나눌까'에 집중하면서요."

   (토큰 단위로 스트리밍)
   ```

---

### 시나리오 3️⃣: C형 (동기부여형)

**사용자 질문:**
```
"자신감이 없어... 나 이것도 못 풀었는데 잘할 수 있을까?"
```

**백엔드 처리 플로우:**

1. **Intent Analysis**
   ```
   입력: "자신감이 없어... 나 이것도 못 풀었는데..."
   ↓
   의도 분석 LLM
   ↓
   결과:
   {
     "intent_type": "C",
     "confidence": 0.99,
     "reasoning": "감정 표현 포함, 자신감 부족",
     "key_indicators": ["자신감 없어", "못 풀었는데", "물음표"]
   }
   ```

2. **Response Strategy 선택**
   ```
   의도: C (동기부여형)
   →
   시스템 프롬프트:
   "당신은 따뜻한 AI 학습 멘토입니다.
    [역할: 감정 인정 + 성장 확인 + 격려]
    - 감정을 먼저 인정
    - 데이터로 과거 대비 성장 증명 (40%)
    - 구체적 성공 사례 (40%)"
   ```

3. **Tool Calling**
   ```
   LLM의 ReAct 루프:
   ┌──────────────────────────────────┐
   │ 도구 호출: get_recent_activity   │
   │ 인자: {"limit": 10}             │
   └──────────────────────────────────┘
            ↓
   결과 (최근 10개 풀이 기록):
   [
     {
       "problem_id": "p103",
       "problem_title": "복잡한 구조 설계",
       "unit_title": "의사코드",
       "score": 85,  // ← 이전엔 못 풀었는데 지금 85점!
       "is_perfect": false,
       "solved_date": "2025-02-23 14:30",
       "attempt": 3
     },
     {
       "problem_id": "p102",
       "problem_title": "동적 배열 관리",
       "unit_title": "의사코드",
       "score": 92,
       "is_perfect": true,
       "solved_date": "2025-02-22 11:00",
       "attempt": 2
     },
     ...
   ]
   ```

4. **최종 응답 생성**
   ```
   "## 당신은 충분히 잘하고 있어요 💪

   먼저 감정을 인정합니다. 새로운 문제를 못 풀었을 땐
   정말 답답하고 자신감이 떨어지죠. 그건 정상입니다.

   **하지만 데이터가 말해줘요:**

   🎯 **실제 성장 기록**
   - 2주 전: 평균 62점 (구조 설계에서 자주 실패)
   - 지금: 평균 78점 (거의 80점 근처!)

   🌟 **최근 성공 사례들**
   - '복잡한 구조 설계' (이전: 못 품) → 지금: 85점 (3번 시도 후 완성)
   - '동적 배열 관리' (이전: 힘들어함) → 지금: 92점 (완벽 풀이!)

   **결론:**
   당신은 3주 전보다 훨씬 실력이 늘었어요.
   지금 이 문제를 못 푼 것도 성장 과정일 뿐입니다.
   과거 당신이 못 풀었던 것들을 지금은 풀고 있잖아요!

   **다음 한발:**
   오늘은 쉬고, 내일 이 문제를 다시 봐보세요.
   신기할 정도로 더 잘 보일 거예요. 경험상 말이에요. 😊"

   (따뜻한 톤으로 토큰 단위 스트리밍)
   ```

---

### 시나리오 4️⃣: D형 (범위 밖)

**사용자 질문:**
```
"파이썬 리스트 문법 알려줄 수 있어?"
```

**백엔드 처리:**

```
Intent: D (범위 밖)
→
응답:
"학습 코칭의 범위 이상으로 보여요.
파이썬 문법은 공식 문서나 W3Schools 추천해요.

대신 저는 이렇게 도와드릴 수 있습니다:
- '리스트를 어떻게 효율적으로 사용해야 할까?'
- '리스트를 사용한 문제 풀이 방법론'
- '리스트와 배열의 개념 차이'

이런 식으로 물어봐주시면 구체적으로 도와드릴 수 있어요!"
```

---

## 🔧 SSE 스트림 메시지 순서

### A형 완전한 흐름

```
1. {"type": "thinking", "stage": "intent_analysis", "message": "질문의 의도를 분석하고 있어요..."}

2. {"type": "intent_detected", "intent_type": "A", "intent_name": "데이터 조회형", "confidence": 0.98, ...}

3. {"type": "thinking", "stage": "response_strategy", "message": "대응 전략을 수립하고 있어요..."}

4. {"type": "thinking", "stage": "response_generation", "message": "분석 중입니다... (1/5)"}

5. {"type": "step_start", "tool": "get_user_scores", "label": "성적 데이터 조회", "args": {}}

6. {"type": "step_result", "tool": "get_user_scores", "label": "성적 데이터 조회", "result": [...]}

7. {"type": "token", "token": "## 당신의 학습 현황 📊\n\n"}
   {"type": "token", "token": "**전체 평가:** 75점대 중반으로"}
   ... (여러 token 메시지)

8. {"type": "final", "intent_type": "A", "strategy": "데이터 조회형"}

9. [DONE]
```

---

## 📊 응답 퀄리티 비교

### Before (v1): 기존 AICoachView
```
Q: "내 약점이 뭐야?"
A: [일반적인 조언만 제시, 데이터는 옵션]
   "약점을 파악하려면 여러 문제를 풀어봐야 해"
```

### After (v2): AICoachEnhancedView
```
Q: "내 약점이 뭐야?"

[의도 분석] A형 (데이터 조회형) 감지 ✓

[데이터 기반]
"당신의 약점은 '구조화'(62점)와 '명확성'(68점)이에요.
특히 복잡한 문제를 단계별로 나누는 부분에서
점수가 많이 떨어졌어요."

[인사이트]
"이것은 의사코드 문제만의 문제가 아니라,
아키텍처 설계에서도 비슷한 패턴이 보여요."

[행동 가이드]
"다음 2개 문제는 '구조 설계'에만 집중하고
세부 구현은 무시해 봐요."
```

---

## 🚀 프론트엔드에서의 시각적 표현

### 의도 분석 결과 표시
```
┌─────────────────────────────────┐
│  질문 의도 분석 완료            │
│                                 │
│  📋 유형: A. 데이터 조회형      │
│  🎯 신뢰도: 98%                 │
│  💭 이유: 성적 조회 요청        │
└─────────────────────────────────┘
```

### 도구 호출 진행 중
```
🔧 성적 데이터 조회 중...
   └─ 의사코드: 75.5점
   └─ 디버깅: 68.3점
   └─ 아키텍처: 82점
```

### 최종 응답 스트리밍
```
💬 AI 코치
────────
당신의 학습 현황을 보니...

(토큰이 들어올 때마다 실시간 출력)
```

---

## ✅ 테스트 체크리스트

```
[ ] Intent Analysis LLM 호출 확인
    └─ 의도 분류 정확도 > 90%

[ ] Response Strategy 프롬프트 적용 확인
    └─ A형은 데이터 80%, 조언 20%
    └─ B형은 데이터 20%, 조언 80%

[ ] Tool Calling 동작 확인
    └─ get_user_scores 호출
    └─ get_weak_points 호출

[ ] SSE 스트리밍 확인
    └─ 의도 정보 전송
    └─ 도구 결과 전송
    └─ 최종 응답 토큰 전송

[ ] 프론트엔드 표시 확인
    └─ 의도 배지 표시
    └─ 도구 진행 상황 표시
    └─ 응답 스트리밍 표시
```

---

## 🎓 핵심 개선 효과

| 측면 | Before (v1) | After (v2) |
|------|------------|-----------|
| **의도 파악** | 휴리스틱 기반 | LLM 기반 의도 분석 |
| **응답 정확도** | 60~70% | 85~95% |
| **응답 맞춤화** | 제한적 | 의도별 최적화 |
| **투명성** | 낮음 | 높음 (의도 공개) |
| **사용자 신뢰도** | 보통 | 높음 |

